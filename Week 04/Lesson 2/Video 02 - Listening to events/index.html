<html>

<head>

</head>

<body>
    <div>
        Name: <input id="name" />    
    </div>
    <div>
        Weight: <input id="weight" type="number" />    
    </div>
    <div>
        <button id="addBtn">Add/Update</button>
    </div>
    
    <svg id="container" height="300" width="500" , style="border: solid 1px #000; margin-top: 10px">
        <g id="body" style="transform:translate(100px,0px)"></g>
        <g id="yAxis"></g>
        <g id="xAxis"></g>

    </svg>
    
    <div id="output"></div>
</body>
<script src="d3.js"></script>
<script>
    let body = d3.select("#body")
    let data = []
    d3.csv("data.csv").then((d) => {
        data = d;
        showData(data)
    })

    d3.select("#addBtn").on("click", () => {
        let name = d3.select("#name").node().value;
        let weight = document.getElementById("weight").value
        let currentIdx = data.findIndex(d => d.Name === name)
        if(currentIdx > -1) {
            data[currentIdx].Weight = weight
        } else {
            data.push({
                Name: name, Weight: weight
            })
        }
        showData(data)
    })

    function clear(text) {
        d3.select("#output").selectAll("div").remove()
    }

    function write(text) {
        d3.select("#output").append("div").text(text)
    }

    function showData(clients) {
        let max = d3.max(clients, d => +d.Weight)
        let scale = d3.scaleLinear().range([0, 300])
            .domain([0, max])

        let scalePosition = d3.scaleBand().rangeRound([0, 200]).domain(clients.map(d => d.Name))
        scalePosition.padding(0.3)
        let join = body.selectAll("rect")
            .data(clients)

        

        join.enter()
            .append("rect")
            .style("fill", "blue")
            .style("stroke", "white")
            .attr("width", d => scale(+d.Weight))
            .attr("height", scalePosition.bandwidth())
            .attr("transform", d => `translate(0,${scalePosition(d.Name)})`)
            .on("click", function(d) {
                if(d3.event.shiftKey){
                    data = data.filter(df => df.Name !== d.Name )
                    showData(data)
                }
            })

        join.transition()
            .attr("height", scalePosition.bandwidth())
            .attr("transform", d => `translate(0,${scalePosition(d.Name)})`)
            .attr("width", d => scale(+d.Weight))


        join.exit()
            .remove()

        let xAxis = d3.axisBottom(scale)
            .ticks(4)
            .tickFormat(d => d + " lb")

        d3.select("#xAxis")
            .style("transform", "translate(100px, 200px)")
            .transition()
            .call(xAxis)

        let yAxis = d3.axisLeft(scalePosition)
        yAxisContainer = d3.select("#yAxis")
            .style("transform", "translate(100px, 0px)")
            .transition()
            .call(yAxis)

        


    }


</script>

</html>